from connectome import Chain, CacheToRam, Apply

from lowres.dataset.luna import LUNA, CacheToDisk
from lowres.dataset.luna.transforms import *


methods = ('image', 'lung_nodules_mask', 'lung_nodules_centers')

preprocessing = [
    DropTracheaMask(),
    ProcessLungsMask(),
    CropToLungsMask(),
    ApplyLungsMask(),
    MakeCentersNComponents(),
    Apply(image=normalize_intensities),
    Apply(image=np.float16, lung_nodules_mask=np.float16),
    CacheToDisk(methods),
    CacheToRam(methods),
]

loader = Chain(
    LUNA(),
    *preprocessing,
)._compile(methods)
